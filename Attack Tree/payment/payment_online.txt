@startuml
skinparam backgroundcolor monochrome
'skinparam monochrome true
skinparam defaultTextAlignment center
skinparam titleFontSize 22
skinparam handwritten true

!define SPRITESURL https://raw.githubusercontent.com/rabelenda/cicon-plantuml-sprites/v1.0/sprites
!includeurl SPRITESURL/user.puml

!define ICONURL https://raw.githubusercontent.com/tupadr3/plantuml-icon-font-sprites/v2.2.0
!includeurl ICONURL/common.puml
!includeurl ICONURL/font-awesome-5/cc_stripe.puml

skinparam rectangle {
  borderColor Black
  backgroundColor #fff
}
skinparam agent {
  borderColor Black
  backgroundColor #fff
}
skinparam sequence{
  arrowColor Black
}
skinparam usecase {
  borderColor #fff
  backgroundColor #fff
  shadowing false
  fontSize 18
}

title

Threat Model | Attack Tree | Payment Online

end title

'legend left
'text
'endlegend

footer

end footer

(key entities/actors within \nthe payment process) as subtitle

rectangle "<$user>\nThreat" as threat #Thistle
rectangle "<$user>\nCustomer" as customer #LightGoldenRodYellow
rectangle "<$user>\nMerchant" as merchant #LightGoldenRodYellow
FA5_CC_STRIPE(stripe,Stripe) #LightGoldenRodYellow

'threat  <. subtitle
'subtitle .> stripe
'subtitle .> merchant
'subtitle .> customer
subtitle .> threat
stripe <. subtitle
merchant <. subtitle
customer <. subtitle

' Root nodes
agent "Intent - Disrupt Business" as goalDisrupt
agent "Intent - Steal Credit Card Details" as goalSteal

subtitle ... goalDisrupt #fff
subtitle ... goalSteal #fff

' goalDisrupt
agent "Prevent Purchases" as goalPrevent
agent "Fraudulent credit \ncard checks" as goalFraudulentCC
agent "Alter Merchant \nApplication" as goalApp
agent "Target Stripe API" as goalStripeApi
agent "Target Stripes Merchant \nDashboard to steal \nprivate keys used \nto create payment intent" as goalMerchantDashboard
agent "Create a \nMock website" as goalMock
agent "Target refund \nprocess" as goalRefund
agent "Domain Hijacking" as goalDomain

goalDisrupt --> goalPrevent
goalDisrupt --> goalFraudulentCC
goalDisrupt --> goalApp
goalDisrupt --> goalStripeApi
goalDisrupt --> goalMerchantDashboard
goalDisrupt --> goalMock
goalDisrupt --> goalRefund
goalDisrupt --> goalDomain

note top of goalFraudulentCC #LightGoldenRodYellow: Thwarted by implementing 3D Secure

agent "Hoax Purchases" as goalHoax
agent "Target Merchant API" as goalMerchantApi

goalPrevent --> goalHoax
goalPrevent --> goalMerchantApi

agent "Application Fault" as goalCrash
agent "App removed from \nthe App Store" as goalRemoveStore

goalApp --> goalCrash
goalApp --> goalRemoveStore

' goalSteal
agent "Target Customer Details \nstored by Merchant (db)" as goalCustLogin
agent "Target Customer Client \n(home pc)" as goalCustClient
agent "Target Stripe" as goalStripe

goalSteal --> goalCustLogin
goalSteal --> goalCustClient
goalSteal --> goalStripe

agent "Target known \nCustomers with \nSocial Engineering \n(phishing, session hijacking)" as goalSocial
agent "Target Stripe for \nadministrative rights" as goalStripeAdmin

goalCustLogin  --> goalSocial
goalCustClient --> goalSocial
goalStripe --> goalStripeApi
goalStripe --> goalStripeAdmin

goalSocial --> goalMock

@enduml